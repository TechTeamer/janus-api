language: node_js

node_js:
  - "8"
  - "10"
  - "12"

git:
  depth: false

before_script:
  - export SONAR_SCANNER_VERSION=4.3.0.2102
  - export SONAR_SCANNER_HOME=$HOME/.sonar/sonar-scanner-$SONAR_SCANNER_VERSION-linux
  - rm -rf $SONAR_SCANNER_HOME
  - mkdir -p $SONAR_SCANNER_HOME
  - curl -sSLo $HOME/.sonar/sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$SONAR_SCANNER_VERSION-linux.zip
  - unzip $HOME/.sonar/sonar-scanner.zip -d $HOME/.sonar/
  - rm $HOME/.sonar/sonar-scanner.zip
  - export PATH=$SONAR_SCANNER_HOME/bin:$PATH
  - export SONAR_SCANNER_OPTS="-server"

script:
  - npm run test
  - sonar-scanner -Dsonar.projectKey=TechTeamer_janus-api -Dsonar.organization=techteamer -Dsonar.sources=. -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=$SONAR_TOKEN